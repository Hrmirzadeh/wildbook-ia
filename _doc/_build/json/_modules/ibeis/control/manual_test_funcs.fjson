{"parents": [{"link": "../../../", "title": "Module code"}, {"link": "../../", "title": "ibeis"}, {"link": "../", "title": "ibeis.control"}], "title": "ibeis.control.manual_test_funcs", "body": "<h1>Source code for ibeis.control.manual_test_funcs</h1><div class=\"highlight\"><pre>\n<span></span><span class=\"c1\"># -*- coding: utf-8 -*-</span>\n<span class=\"sd\">&quot;&quot;&quot;</span>\n<span class=\"sd\">python -c &quot;import utool as ut; ut.write_modscript_alias(&#39;Tgen.sh&#39;, &#39;ibeis.templates.template_generator&#39;)&quot;</span>\n<span class=\"sd\">sh Tgen.sh --key test --invert --Tcfg with_getters=True with_setters=False --modfname manual_test_funcs</span>\n\n<span class=\"sd\"># TODO: Fix this name it is too special case</span>\n<span class=\"sd\">&quot;&quot;&quot;</span>\n<span class=\"kn\">from</span> <span class=\"nn\">__future__</span> <span class=\"k\">import</span> <span class=\"n\">absolute_import</span><span class=\"p\">,</span> <span class=\"n\">division</span><span class=\"p\">,</span> <span class=\"n\">print_function</span><span class=\"p\">,</span> <span class=\"n\">unicode_literals</span>\n<span class=\"kn\">import</span> <span class=\"nn\">six</span>  <span class=\"c1\"># NOQA</span>\n<span class=\"kn\">from</span> <span class=\"nn\">six.moves</span> <span class=\"k\">import</span> <span class=\"nb\">zip</span>\n<span class=\"kn\">import</span> <span class=\"nn\">ubelt</span> <span class=\"k\">as</span> <span class=\"nn\">ub</span>  <span class=\"c1\"># NOQA</span>\n<span class=\"kn\">from</span> <span class=\"nn\">ibeis</span> <span class=\"k\">import</span> <span class=\"n\">constants</span> <span class=\"k\">as</span> <span class=\"n\">const</span>\n<span class=\"kn\">from</span> <span class=\"nn\">ibeis.control</span> <span class=\"k\">import</span> <span class=\"n\">accessor_decors</span><span class=\"p\">,</span> <span class=\"n\">controller_inject</span>  <span class=\"c1\"># NOQA</span>\n<span class=\"kn\">import</span> <span class=\"nn\">utool</span> <span class=\"k\">as</span> <span class=\"nn\">ut</span>\n<span class=\"kn\">import</span> <span class=\"nn\">uuid</span>\n<span class=\"kn\">from</span> <span class=\"nn\">ibeis.control.controller_inject</span> <span class=\"k\">import</span> <span class=\"n\">make_ibs_register_decorator</span>\n<span class=\"nb\">print</span><span class=\"p\">,</span> <span class=\"n\">rrr</span><span class=\"p\">,</span> <span class=\"n\">profile</span> <span class=\"o\">=</span> <span class=\"n\">ut</span><span class=\"o\">.</span><span class=\"n\">inject2</span><span class=\"p\">(</span><span class=\"vm\">__name__</span><span class=\"p\">)</span>\n\n\n<span class=\"n\">VERBOSE_SQL</span>    <span class=\"o\">=</span> <span class=\"n\">ut</span><span class=\"o\">.</span><span class=\"n\">get_argflag</span><span class=\"p\">((</span><span class=\"s1\">&#39;--print-sql&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;--verbose-sql&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;--verb-sql&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;--verbsql&#39;</span><span class=\"p\">))</span>\n<span class=\"n\">CLASS_INJECT_KEY</span><span class=\"p\">,</span> <span class=\"n\">register_ibs_method</span> <span class=\"o\">=</span> <span class=\"n\">make_ibs_register_decorator</span><span class=\"p\">(</span><span class=\"vm\">__name__</span><span class=\"p\">)</span>\n\n\n<span class=\"n\">register_api</span>   <span class=\"o\">=</span> <span class=\"n\">controller_inject</span><span class=\"o\">.</span><span class=\"n\">get_ibeis_flask_api</span><span class=\"p\">(</span><span class=\"vm\">__name__</span><span class=\"p\">)</span>\n\n\n<span class=\"n\">TEST_ROWID</span>         <span class=\"o\">=</span> <span class=\"s1\">&#39;test_rowid&#39;</span>\n<span class=\"n\">TEST_UUID</span>          <span class=\"o\">=</span> <span class=\"s1\">&#39;test_uuid&#39;</span>\n<span class=\"n\">TEST_USER_IDENTITY</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;test_user_identity&#39;</span>\n<span class=\"n\">TEST_CHALLENGE</span>     <span class=\"o\">=</span> <span class=\"s1\">&#39;test_challenge_json&#39;</span>\n<span class=\"n\">TEST_RESPONSE</span>      <span class=\"o\">=</span> <span class=\"s1\">&#39;test_response_json&#39;</span>\n<span class=\"n\">TEST_RESULT</span>        <span class=\"o\">=</span> <span class=\"s1\">&#39;test_result&#39;</span>\n<span class=\"n\">TEST_TIME</span>          <span class=\"o\">=</span> <span class=\"s1\">&#39;test_time_posix&#39;</span>\n\n\n<span class=\"nd\">@register_ibs_method</span>\n<span class=\"nd\">@accessor_decors</span><span class=\"o\">.</span><span class=\"n\">ider</span>\n<span class=\"nd\">@register_api</span><span class=\"p\">(</span><span class=\"s1\">&#39;/api/test/&#39;</span><span class=\"p\">,</span> <span class=\"n\">methods</span><span class=\"o\">=</span><span class=\"p\">[</span><span class=\"s1\">&#39;GET&#39;</span><span class=\"p\">])</span>\n<span class=\"k\">def</span> <span class=\"nf\">_get_all_test_rowids</span><span class=\"p\">(</span><span class=\"n\">ibs</span><span class=\"p\">):</span>\n    <span class=\"sa\">r</span><span class=\"sd\">&quot;&quot;&quot;</span>\n<span class=\"sd\">    Returns:</span>\n<span class=\"sd\">        list_ (list): all nids of known animals</span>\n<span class=\"sd\">        (does not include unknown names)</span>\n<span class=\"sd\">    &quot;&quot;&quot;</span>\n    <span class=\"n\">all_known_test_rowids</span> <span class=\"o\">=</span> <span class=\"n\">ibs</span><span class=\"o\">.</span><span class=\"n\">staging</span><span class=\"o\">.</span><span class=\"n\">get_all_rowids</span><span class=\"p\">(</span><span class=\"n\">const</span><span class=\"o\">.</span><span class=\"n\">TEST_TABLE</span><span class=\"p\">)</span>\n    <span class=\"k\">return</span> <span class=\"n\">all_known_test_rowids</span>\n\n\n<div class=\"viewcode-block\" id=\"add_test\"><a class=\"viewcode-back\" href=\"../../../../ibeis.control/#ibeis.control.manual_test_funcs.add_test\">[docs]</a><span class=\"nd\">@register_ibs_method</span>\n<span class=\"nd\">@accessor_decors</span><span class=\"o\">.</span><span class=\"n\">adder</span>\n<span class=\"nd\">@register_api</span><span class=\"p\">(</span><span class=\"s1\">&#39;/api/test/&#39;</span><span class=\"p\">,</span> <span class=\"n\">methods</span><span class=\"o\">=</span><span class=\"p\">[</span><span class=\"s1\">&#39;POST&#39;</span><span class=\"p\">])</span>\n<span class=\"k\">def</span> <span class=\"nf\">add_test</span><span class=\"p\">(</span><span class=\"n\">ibs</span><span class=\"p\">,</span> <span class=\"n\">test_challenge_list</span><span class=\"p\">,</span> <span class=\"n\">test_response_list</span><span class=\"p\">,</span> <span class=\"n\">test_result_list</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span>\n             <span class=\"n\">test_uuid_list</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span> <span class=\"n\">test_user_identity_list</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">):</span>\n    <span class=\"k\">assert</span> <span class=\"nb\">len</span><span class=\"p\">(</span><span class=\"n\">test_challenge_list</span><span class=\"p\">)</span> <span class=\"o\">==</span> <span class=\"nb\">len</span><span class=\"p\">(</span><span class=\"n\">test_response_list</span><span class=\"p\">)</span>\n    <span class=\"n\">n_input</span> <span class=\"o\">=</span> <span class=\"nb\">len</span><span class=\"p\">(</span><span class=\"n\">test_challenge_list</span><span class=\"p\">)</span>\n\n    <span class=\"n\">test_challenge_list</span> <span class=\"o\">=</span> <span class=\"p\">[</span>\n        <span class=\"n\">ut</span><span class=\"o\">.</span><span class=\"n\">to_json</span><span class=\"p\">(</span><span class=\"n\">test_challenge</span><span class=\"p\">)</span>\n        <span class=\"k\">for</span> <span class=\"n\">test_challenge</span> <span class=\"ow\">in</span> <span class=\"n\">test_challenge_list</span>\n    <span class=\"p\">]</span>\n\n    <span class=\"n\">test_response_list</span> <span class=\"o\">=</span> <span class=\"p\">[</span>\n        <span class=\"n\">ut</span><span class=\"o\">.</span><span class=\"n\">to_json</span><span class=\"p\">(</span><span class=\"n\">test_response</span><span class=\"p\">)</span>\n        <span class=\"k\">for</span> <span class=\"n\">test_response</span> <span class=\"ow\">in</span> <span class=\"n\">test_response_list</span>\n    <span class=\"p\">]</span>\n\n    <span class=\"k\">if</span> <span class=\"n\">test_uuid_list</span> <span class=\"ow\">is</span> <span class=\"kc\">None</span><span class=\"p\">:</span>\n        <span class=\"n\">test_uuid_list</span> <span class=\"o\">=</span> <span class=\"p\">[</span><span class=\"n\">uuid</span><span class=\"o\">.</span><span class=\"n\">uuid4</span><span class=\"p\">()</span> <span class=\"k\">for</span> <span class=\"n\">_</span> <span class=\"ow\">in</span> <span class=\"nb\">range</span><span class=\"p\">(</span><span class=\"n\">n_input</span><span class=\"p\">)]</span>\n    <span class=\"k\">if</span> <span class=\"n\">test_result_list</span> <span class=\"ow\">is</span> <span class=\"kc\">None</span><span class=\"p\">:</span>\n        <span class=\"n\">test_result_list</span> <span class=\"o\">=</span> <span class=\"p\">[</span><span class=\"kc\">None</span><span class=\"p\">]</span> <span class=\"o\">*</span> <span class=\"n\">n_input</span>\n    <span class=\"k\">if</span> <span class=\"n\">test_user_identity_list</span> <span class=\"ow\">is</span> <span class=\"kc\">None</span><span class=\"p\">:</span>\n        <span class=\"n\">test_user_identity_list</span> <span class=\"o\">=</span> <span class=\"p\">[</span><span class=\"kc\">None</span><span class=\"p\">]</span> <span class=\"o\">*</span> <span class=\"n\">n_input</span>\n\n    <span class=\"n\">superkey_paramx</span> <span class=\"o\">=</span> <span class=\"p\">(</span><span class=\"mi\">0</span><span class=\"p\">,)</span>\n    <span class=\"n\">colnames</span> <span class=\"o\">=</span> <span class=\"p\">[</span><span class=\"n\">TEST_UUID</span><span class=\"p\">,</span> <span class=\"n\">TEST_CHALLENGE</span><span class=\"p\">,</span> <span class=\"n\">TEST_RESPONSE</span><span class=\"p\">,</span> <span class=\"n\">TEST_RESULT</span><span class=\"p\">,</span>\n                <span class=\"n\">TEST_USER_IDENTITY</span><span class=\"p\">]</span>\n    <span class=\"n\">params_iter</span> <span class=\"o\">=</span> <span class=\"nb\">list</span><span class=\"p\">(</span><span class=\"nb\">zip</span><span class=\"p\">(</span><span class=\"n\">test_uuid_list</span><span class=\"p\">,</span> <span class=\"n\">test_challenge_list</span><span class=\"p\">,</span> <span class=\"n\">test_response_list</span><span class=\"p\">,</span>\n                           <span class=\"n\">test_result_list</span><span class=\"p\">,</span> <span class=\"n\">test_user_identity_list</span><span class=\"p\">))</span>\n    <span class=\"n\">test_rowid_list</span> <span class=\"o\">=</span> <span class=\"n\">ibs</span><span class=\"o\">.</span><span class=\"n\">staging</span><span class=\"o\">.</span><span class=\"n\">add_cleanly</span><span class=\"p\">(</span><span class=\"n\">const</span><span class=\"o\">.</span><span class=\"n\">TEST_TABLE</span><span class=\"p\">,</span> <span class=\"n\">colnames</span><span class=\"p\">,</span>\n                                                <span class=\"n\">params_iter</span><span class=\"p\">,</span>\n                                                <span class=\"n\">ibs</span><span class=\"o\">.</span><span class=\"n\">get_test_rowids_from_uuid</span><span class=\"p\">,</span>\n                                                <span class=\"n\">superkey_paramx</span><span class=\"p\">)</span>\n    <span class=\"k\">return</span> <span class=\"n\">test_rowid_list</span></div>\n\n\n<div class=\"viewcode-block\" id=\"get_test_rowids_from_uuid\"><a class=\"viewcode-back\" href=\"../../../../ibeis.control/#ibeis.control.manual_test_funcs.get_test_rowids_from_uuid\">[docs]</a><span class=\"nd\">@register_ibs_method</span>\n<span class=\"nd\">@accessor_decors</span><span class=\"o\">.</span><span class=\"n\">getter_1to1</span>\n<span class=\"nd\">@register_api</span><span class=\"p\">(</span><span class=\"s1\">&#39;/api/test/rowid/uuid/&#39;</span><span class=\"p\">,</span> <span class=\"n\">methods</span><span class=\"o\">=</span><span class=\"p\">[</span><span class=\"s1\">&#39;GET&#39;</span><span class=\"p\">])</span>\n<span class=\"k\">def</span> <span class=\"nf\">get_test_rowids_from_uuid</span><span class=\"p\">(</span><span class=\"n\">ibs</span><span class=\"p\">,</span> <span class=\"n\">uuid_list</span><span class=\"p\">):</span>\n    <span class=\"n\">test_rowid_list</span> <span class=\"o\">=</span> <span class=\"n\">ibs</span><span class=\"o\">.</span><span class=\"n\">staging</span><span class=\"o\">.</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"n\">const</span><span class=\"o\">.</span><span class=\"n\">TEST_TABLE</span><span class=\"p\">,</span> <span class=\"p\">(</span><span class=\"n\">TEST_ROWID</span><span class=\"p\">,),</span> <span class=\"n\">uuid_list</span><span class=\"p\">,</span>\n                                      <span class=\"n\">id_colname</span><span class=\"o\">=</span><span class=\"n\">TEST_UUID</span><span class=\"p\">)</span>\n    <span class=\"k\">return</span> <span class=\"n\">test_rowid_list</span></div>\n\n\n<div class=\"viewcode-block\" id=\"delete_test\"><a class=\"viewcode-back\" href=\"../../../../ibeis.control/#ibeis.control.manual_test_funcs.delete_test\">[docs]</a><span class=\"nd\">@register_ibs_method</span>\n<span class=\"nd\">@accessor_decors</span><span class=\"o\">.</span><span class=\"n\">deleter</span>\n<span class=\"nd\">@register_api</span><span class=\"p\">(</span><span class=\"s1\">&#39;/api/test/&#39;</span><span class=\"p\">,</span> <span class=\"n\">methods</span><span class=\"o\">=</span><span class=\"p\">[</span><span class=\"s1\">&#39;DELETE&#39;</span><span class=\"p\">])</span>\n<span class=\"k\">def</span> <span class=\"nf\">delete_test</span><span class=\"p\">(</span><span class=\"n\">ibs</span><span class=\"p\">,</span> <span class=\"n\">test_rowid_list</span><span class=\"p\">):</span>\n    <span class=\"sa\">r</span><span class=\"sd\">&quot;&quot;&quot;</span>\n<span class=\"sd\">    deletes tests from the database</span>\n\n<span class=\"sd\">    RESTful:</span>\n<span class=\"sd\">        Method: DELETE</span>\n<span class=\"sd\">        URL:    /api/test/</span>\n<span class=\"sd\">    &quot;&quot;&quot;</span>\n    <span class=\"k\">if</span> <span class=\"n\">ut</span><span class=\"o\">.</span><span class=\"n\">VERBOSE</span><span class=\"p\">:</span>\n        <span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"s1\">&#39;[ibs] deleting </span><span class=\"si\">%d</span><span class=\"s1\"> tests&#39;</span> <span class=\"o\">%</span> <span class=\"nb\">len</span><span class=\"p\">(</span><span class=\"n\">test_rowid_list</span><span class=\"p\">))</span>\n    <span class=\"n\">ibs</span><span class=\"o\">.</span><span class=\"n\">staging</span><span class=\"o\">.</span><span class=\"n\">delete_rowids</span><span class=\"p\">(</span><span class=\"n\">const</span><span class=\"o\">.</span><span class=\"n\">TEST_TABLE</span><span class=\"p\">,</span> <span class=\"n\">test_rowid_list</span><span class=\"p\">)</span></div>\n\n\n<div class=\"viewcode-block\" id=\"get_test_uuid\"><a class=\"viewcode-back\" href=\"../../../../ibeis.control/#ibeis.control.manual_test_funcs.get_test_uuid\">[docs]</a><span class=\"nd\">@register_ibs_method</span>\n<span class=\"nd\">@accessor_decors</span><span class=\"o\">.</span><span class=\"n\">getter_1to1</span>\n<span class=\"nd\">@register_api</span><span class=\"p\">(</span><span class=\"s1\">&#39;/api/test/uuid/&#39;</span><span class=\"p\">,</span> <span class=\"n\">methods</span><span class=\"o\">=</span><span class=\"p\">[</span><span class=\"s1\">&#39;GET&#39;</span><span class=\"p\">])</span>\n<span class=\"k\">def</span> <span class=\"nf\">get_test_uuid</span><span class=\"p\">(</span><span class=\"n\">ibs</span><span class=\"p\">,</span> <span class=\"n\">test_rowid_list</span><span class=\"p\">):</span>\n    <span class=\"n\">test_uuid_list</span> <span class=\"o\">=</span> <span class=\"n\">ibs</span><span class=\"o\">.</span><span class=\"n\">staging</span><span class=\"o\">.</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"n\">const</span><span class=\"o\">.</span><span class=\"n\">TEST_TABLE</span><span class=\"p\">,</span> <span class=\"p\">(</span><span class=\"n\">TEST_UUID</span><span class=\"p\">,),</span> <span class=\"n\">test_rowid_list</span><span class=\"p\">)</span>\n    <span class=\"k\">return</span> <span class=\"n\">test_uuid_list</span></div>\n\n\n<span class=\"k\">if</span> <span class=\"vm\">__name__</span> <span class=\"o\">==</span> <span class=\"s1\">&#39;__main__&#39;</span><span class=\"p\">:</span>\n    <span class=\"sa\">r</span><span class=\"sd\">&quot;&quot;&quot;</span>\n<span class=\"sd\">    CommandLine:</span>\n<span class=\"sd\">        python -m ibeis.control.manual_test_funcs</span>\n<span class=\"sd\">        python -m ibeis.control.manual_test_funcs --allexamples</span>\n<span class=\"sd\">        python -m ibeis.control.manual_test_funcs --allexamples --noface --nosrc</span>\n<span class=\"sd\">    &quot;&quot;&quot;</span>\n    <span class=\"kn\">import</span> <span class=\"nn\">multiprocessing</span>\n    <span class=\"n\">multiprocessing</span><span class=\"o\">.</span><span class=\"n\">freeze_support</span><span class=\"p\">()</span>  <span class=\"c1\"># for win32</span>\n    <span class=\"kn\">import</span> <span class=\"nn\">utool</span> <span class=\"k\">as</span> <span class=\"nn\">ut</span>  <span class=\"c1\"># NOQA</span>\n    <span class=\"n\">ut</span><span class=\"o\">.</span><span class=\"n\">doctest_funcs</span><span class=\"p\">()</span>\n</pre></div>", "current_page_name": "_modules/ibeis/control/manual_test_funcs", "sidebars": ["localtoc.html", "relations.html", "sourcelink.html", "searchbox.html"], "customsidebar": null, "alabaster_version": "0.7.12"}