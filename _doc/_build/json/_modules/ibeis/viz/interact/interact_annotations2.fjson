{"parents": [{"link": "../../../../", "title": "Module code"}, {"link": "../../../", "title": "ibeis"}, {"link": "../../", "title": "ibeis.viz"}, {"link": "../", "title": "ibeis.viz.interact"}], "title": "ibeis.viz.interact.interact_annotations2", "body": "<h1>Source code for ibeis.viz.interact.interact_annotations2</h1><div class=\"highlight\"><pre>\n<span></span><span class=\"c1\"># -*- coding: utf-8 -*-</span>\n<span class=\"kn\">from</span> <span class=\"nn\">__future__</span> <span class=\"k\">import</span> <span class=\"n\">absolute_import</span><span class=\"p\">,</span> <span class=\"n\">division</span><span class=\"p\">,</span> <span class=\"n\">print_function</span>\n<span class=\"kn\">from</span> <span class=\"nn\">plottool</span> <span class=\"k\">import</span> <span class=\"n\">interact_annotations</span>\n<span class=\"kn\">import</span> <span class=\"nn\">plottool</span> <span class=\"k\">as</span> <span class=\"nn\">pt</span>  <span class=\"c1\"># NOQA</span>\n<span class=\"kn\">import</span> <span class=\"nn\">utool</span> <span class=\"k\">as</span> <span class=\"nn\">ut</span>\n<span class=\"nb\">print</span><span class=\"p\">,</span> <span class=\"n\">rrr</span><span class=\"p\">,</span> <span class=\"n\">profile</span> <span class=\"o\">=</span> <span class=\"n\">ut</span><span class=\"o\">.</span><span class=\"n\">inject2</span><span class=\"p\">(</span><span class=\"vm\">__name__</span><span class=\"p\">)</span>\n\n\n<span class=\"c1\">#DESTROY_OLD_WINDOW = True</span>\n<span class=\"n\">DESTROY_OLD_WINDOW</span> <span class=\"o\">=</span> <span class=\"kc\">False</span>\n\n\n<div class=\"viewcode-block\" id=\"ishow_image2\"><a class=\"viewcode-back\" href=\"../../../../../ibeis.viz.interact/#ibeis.viz.interact.interact_annotations2.ishow_image2\">[docs]</a><span class=\"k\">def</span> <span class=\"nf\">ishow_image2</span><span class=\"p\">(</span><span class=\"n\">ibs</span><span class=\"p\">,</span> <span class=\"n\">gid</span><span class=\"p\">,</span> <span class=\"n\">fnum</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span> <span class=\"n\">dodraw</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">):</span>\n    <span class=\"sa\">r</span><span class=\"sd\">&quot;&quot;&quot;</span>\n<span class=\"sd\">    Args:</span>\n<span class=\"sd\">        ibs (IBEISController):  ibeis controller object</span>\n<span class=\"sd\">        gid (int):</span>\n<span class=\"sd\">        dodraw (bool):</span>\n\n<span class=\"sd\">    CommandLine:</span>\n<span class=\"sd\">        python -m ibeis.viz.interact.interact_annotations2 --test-ishow_image2 --show</span>\n\n<span class=\"sd\">    Example:</span>\n<span class=\"sd\">        &gt;&gt;&gt; # DISABLE_DOCTEST</span>\n<span class=\"sd\">        &gt;&gt;&gt; from ibeis.viz.interact.interact_annotations2 import *  # NOQA</span>\n<span class=\"sd\">        &gt;&gt;&gt; import ibeis</span>\n<span class=\"sd\">        &gt;&gt;&gt; # build test data</span>\n<span class=\"sd\">        &gt;&gt;&gt; ibs = ibeis.opendb(&#39;testdb1&#39;)</span>\n<span class=\"sd\">        &gt;&gt;&gt; gid = 2</span>\n<span class=\"sd\">        &gt;&gt;&gt; dodraw = True</span>\n<span class=\"sd\">        &gt;&gt;&gt; # execute function</span>\n<span class=\"sd\">        &gt;&gt;&gt; self = ishow_image2(ibs, gid, dodraw)</span>\n<span class=\"sd\">        &gt;&gt;&gt; # verify results</span>\n<span class=\"sd\">        &gt;&gt;&gt; result = str(self)</span>\n<span class=\"sd\">        &gt;&gt;&gt; print(result)</span>\n<span class=\"sd\">        &gt;&gt;&gt; pt.show_if_requested()</span>\n<span class=\"sd\">    &quot;&quot;&quot;</span>\n    <span class=\"bp\">self</span> <span class=\"o\">=</span> <span class=\"n\">ANNOTATION_Interaction2</span><span class=\"p\">(</span><span class=\"n\">ibs</span><span class=\"p\">,</span> <span class=\"n\">gid</span><span class=\"p\">,</span> <span class=\"n\">fnum</span><span class=\"o\">=</span><span class=\"n\">fnum</span><span class=\"p\">,</span> <span class=\"n\">dodraw</span><span class=\"o\">=</span><span class=\"n\">dodraw</span><span class=\"p\">)</span>\n    <span class=\"k\">return</span> <span class=\"bp\">self</span></div>\n\n\n<div class=\"viewcode-block\" id=\"ANNOTATION_Interaction2\"><a class=\"viewcode-back\" href=\"../../../../../ibeis.viz.interact/#ibeis.viz.interact.interact_annotations2.ANNOTATION_Interaction2\">[docs]</a><span class=\"k\">class</span> <span class=\"nc\">ANNOTATION_Interaction2</span><span class=\"p\">(</span><span class=\"nb\">object</span><span class=\"p\">):</span>\n    <span class=\"k\">def</span> <span class=\"nf\">__init__</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">ibs</span><span class=\"p\">,</span> <span class=\"n\">gid</span><span class=\"p\">,</span> <span class=\"n\">next_callback</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span> <span class=\"n\">prev_callback</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span>\n                 <span class=\"n\">rows_updated_callback</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span> <span class=\"n\">reset_window</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">,</span> <span class=\"n\">dodraw</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">,</span>\n                 <span class=\"n\">fnum</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">):</span>\n        <span class=\"sd\">&quot;&quot;&quot;</span>\n<span class=\"sd\">        TODO: rename to interact image annotations?</span>\n<span class=\"sd\">        &quot;&quot;&quot;</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">ibs</span> <span class=\"o\">=</span> <span class=\"n\">ibs</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">gid</span> <span class=\"o\">=</span> <span class=\"n\">gid</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">rows_updated_callback</span> <span class=\"o\">=</span> <span class=\"n\">rows_updated_callback</span>\n        <span class=\"n\">img</span> <span class=\"o\">=</span> <span class=\"n\">ibs</span><span class=\"o\">.</span><span class=\"n\">get_images</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">gid</span><span class=\"p\">)</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">aid_list</span> <span class=\"o\">=</span> <span class=\"n\">ibs</span><span class=\"o\">.</span><span class=\"n\">get_image_aids</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">gid</span><span class=\"p\">)</span>\n        <span class=\"n\">bbox_list</span>     <span class=\"o\">=</span> <span class=\"n\">ibs</span><span class=\"o\">.</span><span class=\"n\">get_annot_bboxes</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">aid_list</span><span class=\"p\">)</span>\n        <span class=\"c1\">#verts_list    = ibs.get_annot_verts(self.aid_list)  # TODO</span>\n        <span class=\"n\">theta_list</span>    <span class=\"o\">=</span> <span class=\"n\">ibs</span><span class=\"o\">.</span><span class=\"n\">get_annot_thetas</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">aid_list</span><span class=\"p\">)</span>\n        <span class=\"n\">species_list</span>  <span class=\"o\">=</span> <span class=\"n\">ibs</span><span class=\"o\">.</span><span class=\"n\">get_annot_species_texts</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">aid_list</span><span class=\"p\">)</span>\n        <span class=\"c1\">#valid_species = ibs.get_all_species_texts()</span>\n        <span class=\"n\">valid_species</span> <span class=\"o\">=</span> <span class=\"p\">[</span><span class=\"n\">tup</span><span class=\"p\">[</span><span class=\"mi\">1</span><span class=\"p\">]</span> <span class=\"k\">for</span> <span class=\"n\">tup</span> <span class=\"ow\">in</span>\n                         <span class=\"n\">ibs</span><span class=\"o\">.</span><span class=\"n\">get_working_species</span><span class=\"p\">()]</span>\n        <span class=\"n\">metadata_list</span> <span class=\"o\">=</span> <span class=\"p\">[</span><span class=\"n\">ibs</span><span class=\"o\">.</span><span class=\"n\">get_annot_lazy_dict</span><span class=\"p\">(</span><span class=\"n\">aid</span><span class=\"p\">)</span> <span class=\"k\">for</span> <span class=\"n\">aid</span> <span class=\"ow\">in</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">aid_list</span><span class=\"p\">]</span>\n        <span class=\"k\">for</span> <span class=\"n\">metadata</span> <span class=\"ow\">in</span> <span class=\"n\">metadata_list</span><span class=\"p\">:</span>\n            <span class=\"c1\"># eager eval on name</span>\n            <span class=\"n\">metadata</span><span class=\"p\">[</span><span class=\"s1\">&#39;name&#39;</span><span class=\"p\">]</span>\n        <span class=\"k\">if</span> <span class=\"kc\">True</span><span class=\"p\">:</span>\n            <span class=\"n\">interact_annotations</span><span class=\"o\">.</span><span class=\"n\">rrr</span><span class=\"p\">()</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">interact_ANNOTATIONS</span> <span class=\"o\">=</span> <span class=\"n\">interact_annotations</span><span class=\"o\">.</span><span class=\"n\">AnnotationInteraction</span><span class=\"p\">(</span>\n            <span class=\"n\">img</span><span class=\"p\">,</span>\n            <span class=\"n\">bbox_list</span><span class=\"o\">=</span><span class=\"n\">bbox_list</span><span class=\"p\">,</span>\n            <span class=\"n\">theta_list</span><span class=\"o\">=</span><span class=\"n\">theta_list</span><span class=\"p\">,</span>\n            <span class=\"n\">species_list</span><span class=\"o\">=</span><span class=\"n\">species_list</span><span class=\"p\">,</span>\n            <span class=\"n\">metadata_list</span><span class=\"o\">=</span><span class=\"n\">metadata_list</span><span class=\"p\">,</span>\n            <span class=\"n\">commit_callback</span><span class=\"o\">=</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">commit_callback</span><span class=\"p\">,</span>\n            <span class=\"c1\"># TODO: get default species in a better way</span>\n            <span class=\"n\">default_species</span><span class=\"o\">=</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">ibs</span><span class=\"o\">.</span><span class=\"n\">cfg</span><span class=\"o\">.</span><span class=\"n\">detect_cfg</span><span class=\"o\">.</span><span class=\"n\">species_text</span><span class=\"p\">,</span>\n            <span class=\"n\">next_callback</span><span class=\"o\">=</span><span class=\"n\">next_callback</span><span class=\"p\">,</span>\n            <span class=\"n\">prev_callback</span><span class=\"o\">=</span><span class=\"n\">prev_callback</span><span class=\"p\">,</span>\n            <span class=\"n\">fnum</span><span class=\"o\">=</span><span class=\"n\">fnum</span><span class=\"p\">,</span>\n            <span class=\"n\">valid_species</span><span class=\"o\">=</span><span class=\"n\">valid_species</span><span class=\"p\">,</span>\n            <span class=\"c1\">#figure_to_use=None if reset_window else self.interact_ANNOTATIONS.fig,</span>\n        <span class=\"p\">)</span>\n        <span class=\"k\">if</span> <span class=\"n\">dodraw</span><span class=\"p\">:</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">interact_ANNOTATIONS</span><span class=\"o\">.</span><span class=\"n\">start</span><span class=\"p\">()</span>\n            <span class=\"c1\">#pt.update()</span>\n\n<div class=\"viewcode-block\" id=\"ANNOTATION_Interaction2.commit_callback\"><a class=\"viewcode-back\" href=\"../../../../../ibeis.viz.interact/#ibeis.viz.interact.interact_annotations2.ANNOTATION_Interaction2.commit_callback\">[docs]</a>    <span class=\"k\">def</span> <span class=\"nf\">commit_callback</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">unchanged_indices</span><span class=\"p\">,</span> <span class=\"n\">deleted_indices</span><span class=\"p\">,</span>\n                        <span class=\"n\">changed_indices</span><span class=\"p\">,</span> <span class=\"n\">changed_annottups</span><span class=\"p\">,</span> <span class=\"n\">new_annottups</span><span class=\"p\">):</span>\n        <span class=\"sd\">&quot;&quot;&quot;</span>\n<span class=\"sd\">        TODO: Rename to commit_callback</span>\n<span class=\"sd\">        Callback from interact_annotations to ibs for when data is modified</span>\n<span class=\"sd\">        &quot;&quot;&quot;</span>\n        <span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"s1\">&#39;[interact_annot2] enter commit_callback&#39;</span><span class=\"p\">)</span>\n        <span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"s1\">&#39;[interact_annot2] nUnchanged=</span><span class=\"si\">%d</span><span class=\"s1\">, nDelete=</span><span class=\"si\">%d</span><span class=\"s1\">, nChanged=</span><span class=\"si\">%d</span><span class=\"s1\">, nNew=</span><span class=\"si\">%d</span><span class=\"s1\">&#39;</span> <span class=\"o\">%</span>\n              <span class=\"p\">(</span><span class=\"nb\">len</span><span class=\"p\">(</span><span class=\"n\">unchanged_indices</span><span class=\"p\">),</span> <span class=\"nb\">len</span><span class=\"p\">(</span><span class=\"n\">deleted_indices</span><span class=\"p\">),</span>\n               <span class=\"nb\">len</span><span class=\"p\">(</span><span class=\"n\">changed_indices</span><span class=\"p\">),</span> <span class=\"nb\">len</span><span class=\"p\">(</span><span class=\"n\">new_annottups</span><span class=\"p\">)))</span>\n        <span class=\"n\">rows_updated</span> <span class=\"o\">=</span> <span class=\"kc\">False</span>\n        <span class=\"c1\"># Delete annotations</span>\n        <span class=\"k\">if</span> <span class=\"nb\">len</span><span class=\"p\">(</span><span class=\"n\">deleted_indices</span><span class=\"p\">)</span> <span class=\"o\">&gt;</span> <span class=\"mi\">0</span><span class=\"p\">:</span>\n            <span class=\"n\">rows_updated</span> <span class=\"o\">=</span> <span class=\"kc\">True</span>\n            <span class=\"n\">deleted_aids</span> <span class=\"o\">=</span> <span class=\"p\">[</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">aid_list</span><span class=\"p\">[</span><span class=\"n\">del_index</span><span class=\"p\">]</span> <span class=\"k\">for</span> <span class=\"n\">del_index</span> <span class=\"ow\">in</span> <span class=\"n\">deleted_indices</span><span class=\"p\">]</span>\n            <span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"s1\">&#39;[interact_annot2] deleted_indexes: </span><span class=\"si\">%r</span><span class=\"s1\">&#39;</span> <span class=\"o\">%</span> <span class=\"p\">(</span><span class=\"n\">deleted_indices</span><span class=\"p\">,))</span>\n            <span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"s1\">&#39;[interact_annot2] deleted_aids: </span><span class=\"si\">%r</span><span class=\"s1\">&#39;</span> <span class=\"o\">%</span> <span class=\"p\">(</span><span class=\"n\">deleted_aids</span><span class=\"p\">,))</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">ibs</span><span class=\"o\">.</span><span class=\"n\">delete_annots</span><span class=\"p\">(</span><span class=\"n\">deleted_aids</span><span class=\"p\">)</span>\n        <span class=\"c1\"># Set/Change annotations</span>\n        <span class=\"k\">if</span> <span class=\"nb\">len</span><span class=\"p\">(</span><span class=\"n\">changed_annottups</span><span class=\"p\">)</span> <span class=\"o\">&gt;</span> <span class=\"mi\">0</span><span class=\"p\">:</span>\n            <span class=\"n\">changed_aid</span>   <span class=\"o\">=</span> <span class=\"p\">[</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">aid_list</span><span class=\"p\">[</span><span class=\"n\">index</span><span class=\"p\">]</span> <span class=\"k\">for</span> <span class=\"n\">index</span> <span class=\"ow\">in</span> <span class=\"n\">changed_indices</span><span class=\"p\">]</span>\n            <span class=\"n\">bbox_list1</span>    <span class=\"o\">=</span> <span class=\"p\">[</span><span class=\"n\">bbox</span> <span class=\"k\">for</span> <span class=\"p\">(</span><span class=\"n\">bbox</span><span class=\"p\">,</span> <span class=\"n\">t</span><span class=\"p\">,</span> <span class=\"n\">s</span><span class=\"p\">)</span> <span class=\"ow\">in</span> <span class=\"n\">changed_annottups</span><span class=\"p\">]</span>\n            <span class=\"n\">theta_list1</span>   <span class=\"o\">=</span> <span class=\"p\">[</span><span class=\"n\">t</span>    <span class=\"k\">for</span> <span class=\"p\">(</span><span class=\"n\">bbox</span><span class=\"p\">,</span> <span class=\"n\">t</span><span class=\"p\">,</span> <span class=\"n\">s</span><span class=\"p\">)</span> <span class=\"ow\">in</span> <span class=\"n\">changed_annottups</span><span class=\"p\">]</span>\n            <span class=\"n\">species_list1</span> <span class=\"o\">=</span> <span class=\"p\">[</span><span class=\"n\">s</span>    <span class=\"k\">for</span> <span class=\"p\">(</span><span class=\"n\">bbox</span><span class=\"p\">,</span> <span class=\"n\">t</span><span class=\"p\">,</span> <span class=\"n\">s</span><span class=\"p\">)</span> <span class=\"ow\">in</span> <span class=\"n\">changed_annottups</span><span class=\"p\">]</span>\n            <span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"s1\">&#39;[interact_annot2] changed_indexes: </span><span class=\"si\">%r</span><span class=\"s1\">&#39;</span> <span class=\"o\">%</span> <span class=\"p\">(</span><span class=\"n\">changed_indices</span><span class=\"p\">,))</span>\n            <span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"s1\">&#39;[interact_annot2] changed_aid: </span><span class=\"si\">%r</span><span class=\"s1\">&#39;</span> <span class=\"o\">%</span> <span class=\"p\">(</span><span class=\"n\">changed_aid</span><span class=\"p\">,))</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">ibs</span><span class=\"o\">.</span><span class=\"n\">set_annot_species</span><span class=\"p\">(</span><span class=\"n\">changed_aid</span><span class=\"p\">,</span> <span class=\"n\">species_list1</span><span class=\"p\">)</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">ibs</span><span class=\"o\">.</span><span class=\"n\">set_annot_thetas</span><span class=\"p\">(</span><span class=\"n\">changed_aid</span><span class=\"p\">,</span> <span class=\"n\">theta_list1</span><span class=\"p\">,</span> <span class=\"n\">delete_thumbs</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">)</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">ibs</span><span class=\"o\">.</span><span class=\"n\">set_annot_bboxes</span><span class=\"p\">(</span><span class=\"n\">changed_aid</span><span class=\"p\">,</span> <span class=\"n\">bbox_list1</span><span class=\"p\">,</span> <span class=\"n\">delete_thumbs</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">)</span>\n        <span class=\"c1\"># Add annotations</span>\n        <span class=\"k\">if</span> <span class=\"nb\">len</span><span class=\"p\">(</span><span class=\"n\">new_annottups</span><span class=\"p\">)</span> <span class=\"o\">&gt;</span> <span class=\"mi\">0</span><span class=\"p\">:</span>\n            <span class=\"c1\"># New list returns a list of tuples [(x, y, w, h, theta, species) ...]</span>\n            <span class=\"n\">rows_updated</span> <span class=\"o\">=</span> <span class=\"kc\">True</span>\n            <span class=\"n\">bbox_list2</span>    <span class=\"o\">=</span> <span class=\"p\">[</span><span class=\"n\">bbox</span> <span class=\"k\">for</span> <span class=\"p\">(</span><span class=\"n\">bbox</span><span class=\"p\">,</span> <span class=\"n\">t</span><span class=\"p\">,</span> <span class=\"n\">s</span><span class=\"p\">)</span> <span class=\"ow\">in</span> <span class=\"n\">new_annottups</span><span class=\"p\">]</span>\n            <span class=\"n\">theta_list2</span>   <span class=\"o\">=</span> <span class=\"p\">[</span><span class=\"n\">t</span>    <span class=\"k\">for</span> <span class=\"p\">(</span><span class=\"n\">bbox</span><span class=\"p\">,</span> <span class=\"n\">t</span><span class=\"p\">,</span> <span class=\"n\">s</span><span class=\"p\">)</span> <span class=\"ow\">in</span> <span class=\"n\">new_annottups</span><span class=\"p\">]</span>\n            <span class=\"n\">species_list2</span> <span class=\"o\">=</span> <span class=\"p\">[</span><span class=\"n\">s</span>    <span class=\"k\">for</span> <span class=\"p\">(</span><span class=\"n\">bbox</span><span class=\"p\">,</span> <span class=\"n\">t</span><span class=\"p\">,</span> <span class=\"n\">s</span><span class=\"p\">)</span> <span class=\"ow\">in</span> <span class=\"n\">new_annottups</span><span class=\"p\">]</span>\n            <span class=\"n\">gid_list</span> <span class=\"o\">=</span> <span class=\"p\">[</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">gid</span><span class=\"p\">]</span> <span class=\"o\">*</span> <span class=\"nb\">len</span><span class=\"p\">(</span><span class=\"n\">new_annottups</span><span class=\"p\">)</span>\n            <span class=\"n\">new_aids</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">ibs</span><span class=\"o\">.</span><span class=\"n\">add_annots</span><span class=\"p\">(</span><span class=\"n\">gid_list</span><span class=\"p\">,</span> <span class=\"n\">bbox_list</span><span class=\"o\">=</span><span class=\"n\">bbox_list2</span><span class=\"p\">,</span>\n                                           <span class=\"n\">theta_list</span><span class=\"o\">=</span><span class=\"n\">theta_list2</span><span class=\"p\">,</span>\n                                           <span class=\"n\">species_list</span><span class=\"o\">=</span><span class=\"n\">species_list2</span><span class=\"p\">)</span>\n            <span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"s1\">&#39;[interact_annot2] new_indexes: </span><span class=\"si\">%r</span><span class=\"s1\">&#39;</span> <span class=\"o\">%</span> <span class=\"p\">(</span><span class=\"n\">new_annottups</span><span class=\"p\">,))</span>\n            <span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"s1\">&#39;[interact_annot2] new_aids: </span><span class=\"si\">%r</span><span class=\"s1\">&#39;</span> <span class=\"o\">%</span> <span class=\"p\">(</span><span class=\"n\">new_aids</span><span class=\"p\">,))</span>\n\n        <span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"s1\">&#39;[interact_annot2] about to exit callback&#39;</span><span class=\"p\">)</span>\n        <span class=\"k\">if</span> <span class=\"n\">rows_updated</span> <span class=\"ow\">and</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">rows_updated_callback</span> <span class=\"ow\">is</span> <span class=\"ow\">not</span> <span class=\"kc\">None</span><span class=\"p\">:</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">rows_updated_callback</span><span class=\"p\">()</span>\n        <span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"s1\">&#39;[interact_annot2] exit callback&#39;</span><span class=\"p\">)</span></div>\n\n<div class=\"viewcode-block\" id=\"ANNOTATION_Interaction2.update_image_and_callbacks\"><a class=\"viewcode-back\" href=\"../../../../../ibeis.viz.interact/#ibeis.viz.interact.interact_annotations2.ANNOTATION_Interaction2.update_image_and_callbacks\">[docs]</a>    <span class=\"k\">def</span> <span class=\"nf\">update_image_and_callbacks</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">gid</span><span class=\"p\">,</span> <span class=\"n\">nextcb</span><span class=\"p\">,</span> <span class=\"n\">prevcb</span><span class=\"p\">,</span> <span class=\"n\">do_save</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">):</span>\n        <span class=\"k\">if</span> <span class=\"n\">do_save</span><span class=\"p\">:</span>\n            <span class=\"c1\"># save the current changes when pressing next or previous</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">interact_ANNOTATIONS</span><span class=\"o\">.</span><span class=\"n\">save_and_exit</span><span class=\"p\">(</span><span class=\"kc\">None</span><span class=\"p\">,</span> <span class=\"n\">do_close</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">)</span>\n        <span class=\"k\">if</span> <span class=\"n\">DESTROY_OLD_WINDOW</span><span class=\"p\">:</span>\n            <span class=\"n\">ANNOTATION_Interaction2</span><span class=\"o\">.</span><span class=\"fm\">__init__</span><span class=\"p\">(</span>\n                <span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">ibs</span><span class=\"p\">,</span> <span class=\"n\">gid</span><span class=\"p\">,</span> <span class=\"n\">next_callback</span><span class=\"o\">=</span><span class=\"n\">nextcb</span><span class=\"p\">,</span>\n                <span class=\"n\">prev_callback</span><span class=\"o\">=</span><span class=\"n\">prevcb</span><span class=\"p\">,</span>\n                <span class=\"n\">rows_updated_callback</span><span class=\"o\">=</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">rows_updated_callback</span><span class=\"p\">,</span>\n                <span class=\"n\">reset_window</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">)</span>\n        <span class=\"k\">else</span><span class=\"p\">:</span>\n            <span class=\"k\">if</span> <span class=\"kc\">True</span><span class=\"p\">:</span>\n                <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">interact_ANNOTATIONS</span><span class=\"o\">.</span><span class=\"n\">rrr</span><span class=\"p\">()</span>\n            <span class=\"n\">ibs</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">ibs</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">gid</span> <span class=\"o\">=</span> <span class=\"n\">gid</span>\n            <span class=\"n\">img</span> <span class=\"o\">=</span> <span class=\"n\">ibs</span><span class=\"o\">.</span><span class=\"n\">get_images</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">gid</span><span class=\"p\">)</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">aid_list</span> <span class=\"o\">=</span> <span class=\"n\">ibs</span><span class=\"o\">.</span><span class=\"n\">get_image_aids</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">gid</span><span class=\"p\">)</span>\n            <span class=\"n\">bbox_list</span> <span class=\"o\">=</span> <span class=\"n\">ibs</span><span class=\"o\">.</span><span class=\"n\">get_annot_bboxes</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">aid_list</span><span class=\"p\">)</span>\n            <span class=\"n\">theta_list</span> <span class=\"o\">=</span> <span class=\"n\">ibs</span><span class=\"o\">.</span><span class=\"n\">get_annot_thetas</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">aid_list</span><span class=\"p\">)</span>\n            <span class=\"n\">species_list</span> <span class=\"o\">=</span> <span class=\"n\">ibs</span><span class=\"o\">.</span><span class=\"n\">get_annot_species_texts</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">aid_list</span><span class=\"p\">)</span>\n            <span class=\"n\">metadata_list</span> <span class=\"o\">=</span> <span class=\"p\">[</span><span class=\"n\">ibs</span><span class=\"o\">.</span><span class=\"n\">get_annot_lazy_dict</span><span class=\"p\">(</span><span class=\"n\">aid</span><span class=\"p\">)</span> <span class=\"k\">for</span> <span class=\"n\">aid</span> <span class=\"ow\">in</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">aid_list</span><span class=\"p\">]</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">interact_ANNOTATIONS</span><span class=\"o\">.</span><span class=\"n\">update_image_and_callbacks</span><span class=\"p\">(</span>\n                <span class=\"n\">img</span><span class=\"p\">,</span>\n                <span class=\"n\">bbox_list</span><span class=\"o\">=</span><span class=\"n\">bbox_list</span><span class=\"p\">,</span>\n                <span class=\"n\">theta_list</span><span class=\"o\">=</span><span class=\"n\">theta_list</span><span class=\"p\">,</span>\n                <span class=\"n\">species_list</span><span class=\"o\">=</span><span class=\"n\">species_list</span><span class=\"p\">,</span>\n                <span class=\"n\">metadata_list</span><span class=\"o\">=</span><span class=\"n\">metadata_list</span><span class=\"p\">,</span>\n                <span class=\"n\">next_callback</span><span class=\"o\">=</span><span class=\"n\">nextcb</span><span class=\"p\">,</span>\n                <span class=\"n\">prev_callback</span><span class=\"o\">=</span><span class=\"n\">prevcb</span><span class=\"p\">,</span>\n            <span class=\"p\">)</span></div></div>\n\n\n<span class=\"k\">if</span> <span class=\"vm\">__name__</span> <span class=\"o\">==</span> <span class=\"s1\">&#39;__main__&#39;</span><span class=\"p\">:</span>\n    <span class=\"sd\">&quot;&quot;&quot;</span>\n<span class=\"sd\">    CommandLine:</span>\n<span class=\"sd\">        python -m ibeis.viz.interact.interact_annotations2</span>\n<span class=\"sd\">        python -m ibeis.viz.interact.interact_annotations2 --allexamples</span>\n<span class=\"sd\">        python -m ibeis.viz.interact.interact_annotations2 --allexamples --noface --nosrc</span>\n<span class=\"sd\">    &quot;&quot;&quot;</span>\n    <span class=\"kn\">import</span> <span class=\"nn\">multiprocessing</span>\n    <span class=\"n\">multiprocessing</span><span class=\"o\">.</span><span class=\"n\">freeze_support</span><span class=\"p\">()</span>  <span class=\"c1\"># for win32</span>\n    <span class=\"kn\">import</span> <span class=\"nn\">utool</span> <span class=\"k\">as</span> <span class=\"nn\">ut</span>  <span class=\"c1\"># NOQA</span>\n    <span class=\"n\">ut</span><span class=\"o\">.</span><span class=\"n\">doctest_funcs</span><span class=\"p\">()</span>\n</pre></div>", "current_page_name": "_modules/ibeis/viz/interact/interact_annotations2", "sidebars": ["localtoc.html", "relations.html", "sourcelink.html", "searchbox.html"], "customsidebar": null, "alabaster_version": "0.7.12"}